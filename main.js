(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var t=function(){function t(e,n,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._name=e,this._link=n,this._template=r,this._handleCardClick=o}var n,r;return n=t,(r=[{key:"generateCard",value:function(){return this._element=this._template,this._image=this._element.querySelector(".element__image"),this._image.src=this._link,this._image.alt=this._name,this._element.querySelector(".element__title").textContent=this._name,this._setEventListeners(),this._element}},{key:"_handleDeleteCard",value:function(){this._element.remove()}},{key:"_setEventListeners",value:function(){var e=this;this._element.querySelector(".element__delete-button").addEventListener("click",(function(){e._handleDeleteCard()})),this._element.querySelector(".element__like-image").addEventListener("click",(function(e){e.target.classList.toggle("element__like-image-active")})),this._image.addEventListener("click",(function(){return e._handleCardClick({name:e._name,link:e._link})}))}}])&&e(n.prototype,r),t}(),n={formSelector:".popup__form",inputSelector:".popup__field",formAdd:".popup_type_add",formEdit:".popup_type_edit",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button-disabled",inputErrorClass:"popup__field-error",errorClass:"popup__field-error-active"},r=(document.querySelector(".popup__image"),document.querySelector(".popup__caption"),document.querySelector(".popup_type_add")),o=document.querySelector(".profile__edit-button"),i=document.querySelector(".profile__add-button");function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._formElement=document.querySelector(n),this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._inactiveButtonClass=t.inactiveButtonClass,this._inputErrorClass=t.inputErrorClass,this._errorClass=t.errorClass}var t,n;return t=e,(n=[{key:"_showInputError",value:function(e,t){var n=this._formElement.querySelector("#".concat(e.id,"-error"));n.classList.add(this._errorClass),n.textContent=t}},{key:"_hideInputError",value:function(e){var t=this._formElement.querySelector("#".concat(e.id,"-error"));e.classList.remove(this._errorClass),t.textContent=""}},{key:"_checkInputValidity",value:function(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}},{key:"_hasInvalidInput",value:function(e){return e.some((function(e){return!e.validity.valid}))}},{key:"toggleButtonState",value:function(e,t){this._hasInvalidInput(e)?(t.classList.add(this._inactiveButtonClass),t.setAttribute("disabled",!0)):(t.classList.remove(this._inactiveButtonClass),t.removeAttribute("disabled"))}},{key:"_setEventListeners",value:function(){var e=this,t=Array.from(this._formElement.querySelectorAll(this._inputSelector)),n=this._formElement.querySelector(this._submitButtonSelector);t.forEach((function(r){r.addEventListener("input",(function(){e._checkInputValidity(r),e.toggleButtonState(t,n)}))}))}},{key:"enableValidation",value:function(){this._formElement.addEventListener("submit",(function(e){e.preventDefault()})),this._setEventListeners()}}])&&u(t.prototype,n),e}();function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=function(){function e(t,n){var r=t.items,o=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._renderedItems=r,this._renderer=o,this._container=document.querySelector(n)}var t,n;return t=e,(n=[{key:"renderItems",value:function(){var e=this;this._renderedItems.forEach((function(t){return e._renderer(t)}))}},{key:"addItem",value:function(e){this._container.prepend(e)}}])&&a(t.prototype,n),e}();function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popup=document.querySelector(t),this._handleEscClose=this._handleEscClose.bind(this)}var t,n;return t=e,(n=[{key:"open",value:function(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}},{key:"_handleEscClose",value:function(){var e=this;this._popup.classList.contains("popup_opened")?document.addEventListener("keydown",(function(t){"Escape"===t.key&&e.close()})):document.removeEventListener("keydown",(function(t){"Escape"===t.key&&e.close()}))}},{key:"setEventListeners",value:function(e){var t=this;this._popup.querySelector(".popup__close").addEventListener("click",(function(){return t.close()})),this._popup.addEventListener("click",(function(e){e.target===e.currentTarget&&t.close(e.currentTarget)}))}}])&&s(t.prototype,n),e}();function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t,n){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=h(r);if(o){var n=h(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return m(this,e)});function u(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),i.call(this,e)}return t=u,(n=[{key:"open",value:function(e,t){this._popupImage=document.querySelector(".popup__image"),this._popupTitle=document.querySelector(".popup__caption"),this._popupImage.src=t,this._popupTitle=e,y(h(u.prototype),"open",this).call(this)}}])&&d(t.prototype,n),u}(p);function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t,n){return(S="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=w(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function E(e,t){return!t||"object"!==b(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=w(r);if(o){var n=w(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return E(this,e)});function u(e){var t,n=e.popupSelector,r=e.handleFormSubmit;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=i.call(this,n))._handleFormSubmit=r,t}return t=u,(n=[{key:"_getInputValues",value:function(){var e=this,t=document.querySelectorAll(".popup__field");return this._inputValues={},t.forEach((function(t){e._inputValues[t.name]=t.value})),this._inputValues}},{key:"close",value:function(){S(w(u.prototype),"close",this).call(this),this._popup.querySelector("form").reset()}},{key:"setEventListeners",value:function(e){var t=this;S(w(u.prototype),"setEventListeners",this).call(this,e),this._popup.addEventListener("submit",(function(e){e.preventDefault(),t._handleFormSubmit(t._getInputValues())}))}}])&&g(t.prototype,n),u}(p);function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var L=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.titleSelector=document.querySelector(".profile__title"),this.subtitleSelector=document.querySelector(".profile__subtitle")}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return{name:this.titleSelector.textContent,jobInput:this.subtitleSelector.textContent}}},{key:"setUserInfo",value:function(e){var t=e.name,n=e.job;this.titleSelector.textContent=t,this.subtitleSelector.textContent=n}}])&&j(t.prototype,n),e}()),O=new v(".popup_type_img");O.setEventListeners();var q=function(e){var t=e.name,n=e.link;O.open(t,n)},I=new l({items:[{name:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{name:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{name:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{name:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{name:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{name:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}],renderer:function(e){var n=new t(e.name,e.link,document.querySelector("#elements").content.querySelector(".element__cards").cloneNode(!0),q).generateCard();I.addItem(n)}},".element");I.renderItems();var P=new C({popupSelector:".popup_type_add",handleFormSubmit:function(e){cardList.addItem({name:e.title,link:e.picture}),P.close()}});P.setEventListeners(R),i.addEventListener("click",(function(){P.open();var e=Array.from(r.querySelectorAll(".popup__field")),t=r.querySelector(".popup__submit-button");x.toggleButtonState(e,t)}));var R=new C({popupSelector:".popup_type_edit",handleFormSubmit:function(e){L.setUserInfo({name:e.fullname,job:e.job}),R.close()}});o.addEventListener("click",(function(){var e=L.getUserInfo(),t=document.querySelector(".popup__field_input_name"),n=document.querySelector(".popup__field_input_job");t.value=e.name,n.value=e.jobInput,R.open()})),R.setEventListeners();var x=new c(n,n.formAdd);x.enableValidation(),new c(n,n.formEdit).enableValidation()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tZXN0by8uL3NyYy9jb21wb25lbnRzL0NhcmQuanMiLCJ3ZWJwYWNrOi8vbWVzdG8vLi9zcmMvdXRpbHMvY29uc3RhbnQuanMiLCJ3ZWJwYWNrOi8vbWVzdG8vLi9zcmMvY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL21lc3RvLy4vc3JjL2NvbXBvbmVudHMvU2VjdGlvbi5qcyIsIndlYnBhY2s6Ly9tZXN0by8uL3NyYy9jb21wb25lbnRzL1BvcHVwLmpzIiwid2VicGFjazovL21lc3RvLy4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanMiLCJ3ZWJwYWNrOi8vbWVzdG8vLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL21lc3RvLy4vc3JjL2NvbXBvbmVudHMvVXNlckluZm8uanMiLCJ3ZWJwYWNrOi8vbWVzdG8vLi9zcmMvcGFnZXMvaW5kZXguanMiXSwibmFtZXMiOlsiQ2FyZCIsIm5hbWUiLCJsaW5rIiwidGVtcGxhdGUiLCJoYW5kbGVDYXJkQ2xpY2siLCJ0aGlzIiwiX25hbWUiLCJfbGluayIsIl90ZW1wbGF0ZSIsIl9oYW5kbGVDYXJkQ2xpY2siLCJfZWxlbWVudCIsIl9pbWFnZSIsInF1ZXJ5U2VsZWN0b3IiLCJzcmMiLCJhbHQiLCJ0ZXh0Q29udGVudCIsIl9zZXRFdmVudExpc3RlbmVycyIsInJlbW92ZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJfaGFuZGxlRGVsZXRlQ2FyZCIsImV2ZW50IiwidGFyZ2V0IiwiY2xhc3NMaXN0IiwidG9nZ2xlIiwicGFyYW1zIiwiZm9ybVNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsImZvcm1BZGQiLCJmb3JtRWRpdCIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsImlucHV0RXJyb3JDbGFzcyIsImVycm9yQ2xhc3MiLCJwb3B1cEFkZCIsImRvY3VtZW50IiwicHJvZmlsZUVkaXRCdXR0b24iLCJhZGRDYXJkQnV0dG9uIiwiRm9ybVZhbGlkYXRvciIsImZvcm1FbGVtZW50IiwiX2Zvcm1FbGVtZW50IiwiX2lucHV0U2VsZWN0b3IiLCJfc3VibWl0QnV0dG9uU2VsZWN0b3IiLCJfaW5hY3RpdmVCdXR0b25DbGFzcyIsIl9pbnB1dEVycm9yQ2xhc3MiLCJfZXJyb3JDbGFzcyIsImlucHV0RWxlbWVudCIsImVycm9yTWVzc2FnZSIsImVycm9yRWxlbWVudCIsImlkIiwiYWRkIiwidmFsaWRpdHkiLCJ2YWxpZCIsIl9oaWRlSW5wdXRFcnJvciIsIl9zaG93SW5wdXRFcnJvciIsInZhbGlkYXRpb25NZXNzYWdlIiwiaW5wdXRMaXN0Iiwic29tZSIsImJ1dHRvbkVsZW1lbnQiLCJfaGFzSW52YWxpZElucHV0Iiwic2V0QXR0cmlidXRlIiwicmVtb3ZlQXR0cmlidXRlIiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJfY2hlY2tJbnB1dFZhbGlkaXR5IiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJwcmV2ZW50RGVmYXVsdCIsIlNlY3Rpb24iLCJjb250YWluZXJTZWxlY3RvciIsIml0ZW1zIiwicmVuZGVyZXIiLCJfcmVuZGVyZWRJdGVtcyIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJpdGVtIiwiZWxlbWVudCIsInByZXBlbmQiLCJQb3B1cCIsInBvcHVwU2VsZWN0b3IiLCJfcG9wdXAiLCJfaGFuZGxlRXNjQ2xvc2UiLCJiaW5kIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImNvbnRhaW5zIiwiZXZ0Iiwia2V5IiwiY2xvc2UiLCJwb3B1cCIsImN1cnJlbnRUYXJnZXQiLCJQb3B1cFdpdGhJbWFnZSIsIl9wb3B1cEltYWdlIiwiX3BvcHVwVGl0bGUiLCJQb3B1cFdpdGhGb3JtIiwiaGFuZGxlRm9ybVN1Ym1pdCIsIl9oYW5kbGVGb3JtU3VibWl0IiwidXNlcklucHV0cyIsIl9pbnB1dFZhbHVlcyIsInZhbHVlIiwicmVzZXQiLCJfZ2V0SW5wdXRWYWx1ZXMiLCJ1c2VySW5mbyIsInRpdGxlU2VsZWN0b3IiLCJzdWJ0aXRsZVNlbGVjdG9yIiwiam9iSW5wdXQiLCJqb2IiLCJwb3B1cEltYWdlIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJvcGVuIiwiY2FyZHNMaXN0IiwiY2FyZEVsZW1lbnQiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiZ2VuZXJhdGVDYXJkIiwiYWRkSXRlbSIsInJlbmRlckl0ZW1zIiwiaW5wdXRWYWx1ZXMiLCJjYXJkTGlzdCIsInRpdGxlIiwicGljdHVyZSIsImZvcm1BZGRWYWxpZGF0b3IiLCJpbnB1dHNWYWx1ZXMiLCJzZXRVc2VySW5mbyIsImZ1bGxuYW1lIiwicHJvZmlsZSIsImdldFVzZXJJbmZvIiwiaW5wdXRzTmFtZSIsImlucHV0c0pvYiIsImVuYWJsZVZhbGlkYXRpb24iXSwibWFwcGluZ3MiOiJ5TEFBTyxJQUFNQSxFQUFiLFdBQ0ksV0FBWUMsRUFBTUMsRUFBTUMsRUFBVUMsSSw0RkFBaUIsU0FDL0NDLEtBQUtDLE1BQVFMLEVBQ2JJLEtBQUtFLE1BQVFMLEVBQ2JHLEtBQUtHLFVBQVlMLEVBQ2pCRSxLQUFLSSxpQkFBbUJMLEUsUUFMaEMsTyxFQUFBLEcsRUFBQSxzQ0FpQlEsT0FSQUMsS0FBS0ssU0FBV0wsS0FBS0csVUFDckJILEtBQUtNLE9BQVNOLEtBQUtLLFNBQVNFLGNBQWMsbUJBQzFDUCxLQUFLTSxPQUFPRSxJQUFNUixLQUFLRSxNQUN2QkYsS0FBS00sT0FBT0csSUFBTVQsS0FBS0MsTUFDdkJELEtBQUtLLFNBQVNFLGNBQWMsbUJBQW1CRyxZQUFjVixLQUFLQyxNQUVsRUQsS0FBS1cscUJBRUVYLEtBQUtLLFdBakJwQiwwQ0FxQlFMLEtBQUtLLFNBQVNPLFdBckJ0QiwyQ0F3QnlCLFdBQ2pCWixLQUFLSyxTQUNBRSxjQUFjLDJCQUNkTSxpQkFBaUIsU0FBUyxXQUN2QixFQUFLQyx1QkFHYmQsS0FBS0ssU0FDQUUsY0FBYyx3QkFDZE0saUJBQWlCLFNBQVMsU0FBQUUsR0FDdkJBLEVBQU1DLE9BQU9DLFVBQVVDLE9BQU8s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cENtSCxFQUFZN0YsU0FBU3RCLGNBQWMsMkJBRXpDa0gsRUFBVzVCLE1BQVEwQixFQUFRM0gsS0FDM0I4SCxFQUFVN0IsTUFBUTBCLEVBQVFwQixTQUUxQjVFLEVBQVNnRixVQUdiaEYsRUFBUytFLG9CQUVULElBQU1hLEVBQW1CLElBQUluRixFQUFjYixFQUFRQSxFQUFPRyxTQUMxRDZGLEVBQWlCUSxtQkFFUyxJQUFJM0YsRUFBY2IsRUFBUUEsRUFBT0ksVUFDekNvRyxvQiIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNsYXNzIENhcmQge1xuICAgIGNvbnN0cnVjdG9yKG5hbWUsIGxpbmssIHRlbXBsYXRlLCBoYW5kbGVDYXJkQ2xpY2spIHtcbiAgICAgICAgdGhpcy5fbmFtZSA9IG5hbWU7XG4gICAgICAgIHRoaXMuX2xpbmsgPSBsaW5rO1xuICAgICAgICB0aGlzLl90ZW1wbGF0ZSA9IHRlbXBsYXRlO1xuICAgICAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2sgPSBoYW5kbGVDYXJkQ2xpY2s7XG4gICAgfVxuXG4gICAgZ2VuZXJhdGVDYXJkKCkge1xuICAgICAgICB0aGlzLl9lbGVtZW50ID0gdGhpcy5fdGVtcGxhdGU7XG4gICAgICAgIHRoaXMuX2ltYWdlID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuZWxlbWVudF9faW1hZ2UnKTtcbiAgICAgICAgdGhpcy5faW1hZ2Uuc3JjID0gdGhpcy5fbGluaztcbiAgICAgICAgdGhpcy5faW1hZ2UuYWx0ID0gdGhpcy5fbmFtZTtcbiAgICAgICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuZWxlbWVudF9fdGl0bGUnKS50ZXh0Q29udGVudCA9IHRoaXMuX25hbWU7XG5cbiAgICAgICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuICAgICAgICByZXR1cm4gdGhpcy5fZWxlbWVudDtcbiAgICB9XG5cbiAgICBfaGFuZGxlRGVsZXRlQ2FyZCgpIHtcbiAgICAgICAgdGhpcy5fZWxlbWVudC5yZW1vdmUoKTtcbiAgICB9XG5cbiAgICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgICAgIHRoaXMuX2VsZW1lbnRcbiAgICAgICAgICAgIC5xdWVyeVNlbGVjdG9yKCcuZWxlbWVudF9fZGVsZXRlLWJ1dHRvbicpXG4gICAgICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlRGVsZXRlQ2FyZCgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5fZWxlbWVudFxuICAgICAgICAgICAgLnF1ZXJ5U2VsZWN0b3IoJy5lbGVtZW50X19saWtlLWltYWdlJylcbiAgICAgICAgICAgIC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGV2ZW50ID0+IHtcbiAgICAgICAgICAgICAgICBldmVudC50YXJnZXQuY2xhc3NMaXN0LnRvZ2dsZSgnZWxlbWVudF9fbGlrZS1pbWFnZS1hY3RpdmUnKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuX2ltYWdlXG4gICAgICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB0aGlzLl9oYW5kbGVDYXJkQ2xpY2soeyBuYW1lOiB0aGlzLl9uYW1lLCBsaW5rOiB0aGlzLl9saW5rfSkpO1xuICAgIH1cbn0gIiwiZXhwb3J0IGNvbnN0IGluaXRpYWxDYXJkcyA9IFtcbiAgICB7XG4gICAgICAgIG5hbWU6ICfQkNGA0YXRi9C3JyxcbiAgICAgICAgbGluazogJ2h0dHBzOi8vcGljdHVyZXMuczMueWFuZGV4Lm5ldC9mcm9udGVuZC1kZXZlbG9wZXIvY2FyZHMtY29tcHJlc3NlZC9hcmtoeXouanBnJ1xuICAgIH0sXG4gICAge1xuICAgICAgICBuYW1lOiAn0KfQtdC70Y/QsdC40L3RgdC60LDRjyDQvtCx0LvQsNGB0YLRjCcsXG4gICAgICAgIGxpbms6ICdodHRwczovL3BpY3R1cmVzLnMzLnlhbmRleC5uZXQvZnJvbnRlbmQtZGV2ZWxvcGVyL2NhcmRzLWNvbXByZXNzZWQvY2hlbHlhYmluc2stb2JsYXN0LmpwZydcbiAgICB9LFxuICAgIHtcbiAgICAgICAgbmFtZTogJ9CY0LLQsNC90L7QstC+JyxcbiAgICAgICAgbGluazogJ2h0dHBzOi8vcGljdHVyZXMuczMueWFuZGV4Lm5ldC9mcm9udGVuZC1kZXZlbG9wZXIvY2FyZHMtY29tcHJlc3NlZC9pdmFub3ZvLmpwZydcbiAgICB9LFxuICAgIHtcbiAgICAgICAgbmFtZTogJ9Ca0LDQvNGH0LDRgtC60LAnLFxuICAgICAgICBsaW5rOiAnaHR0cHM6Ly9waWN0dXJlcy5zMy55YW5kZXgubmV0L2Zyb250ZW5kLWRldmVsb3Blci9jYXJkcy1jb21wcmVzc2VkL2thbWNoYXRrYS5qcGcnXG4gICAgfSxcbiAgICB7XG4gICAgICAgIG5hbWU6ICfQpdC+0LvQvNC+0LPQvtGA0YHQutC40Lkg0YDQsNC50L7QvScsXG4gICAgICAgIGxpbms6ICdodHRwczovL3BpY3R1cmVzLnMzLnlhbmRleC5uZXQvZnJvbnRlbmQtZGV2ZWxvcGVyL2NhcmRzLWNvbXByZXNzZWQva2hvbG1vZ29yc2t5LXJheW9uLmpwZydcbiAgICB9LFxuICAgIHtcbiAgICAgICAgbmFtZTogJ9CR0LDQudC60LDQuycsXG4gICAgICAgIGxpbms6ICdodHRwczovL3BpY3R1cmVzLnMzLnlhbmRleC5uZXQvZnJvbnRlbmQtZGV2ZWxvcGVyL2NhcmRzLWNvbXByZXNzZWQvYmFpa2FsLmpwZydcbiAgICB9XG5dO1xuXG5leHBvcnQgY29uc3QgcGFyYW1zID0ge1xuICAgIGZvcm1TZWxlY3RvcjogJy5wb3B1cF9fZm9ybScsXG4gICAgaW5wdXRTZWxlY3RvcjogJy5wb3B1cF9fZmllbGQnLFxuICAgIGZvcm1BZGQ6ICcucG9wdXBfdHlwZV9hZGQnLFxuICAgIGZvcm1FZGl0OiAnLnBvcHVwX3R5cGVfZWRpdCcsXG4gICAgc3VibWl0QnV0dG9uU2VsZWN0b3I6ICcucG9wdXBfX3N1Ym1pdC1idXR0b24nLFxuICAgIGluYWN0aXZlQnV0dG9uQ2xhc3M6ICdwb3B1cF9fc3VibWl0LWJ1dHRvbi1kaXNhYmxlZCcsXG4gICAgaW5wdXRFcnJvckNsYXNzOiAncG9wdXBfX2ZpZWxkLWVycm9yJyxcbiAgICBlcnJvckNsYXNzOiAncG9wdXBfX2ZpZWxkLWVycm9yLWFjdGl2ZSdcbn1cblxuZXhwb3J0IGNvbnN0IHBvcHVwSW1hZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2ltYWdlJyk7XG5leHBvcnQgY29uc3QgcG9wdXBUaXRsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fY2FwdGlvbicpO1xuXG5leHBvcnQgY29uc3QgcG9wdXBBZGQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfdHlwZV9hZGQnKTtcblxuZXhwb3J0IGNvbnN0IHByb2ZpbGVFZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2VkaXQtYnV0dG9uJyk7XG5leHBvcnQgY29uc3QgYWRkQ2FyZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19hZGQtYnV0dG9uJyk7IiwiZXhwb3J0IGNsYXNzIEZvcm1WYWxpZGF0b3Ige1xuICAgIGNvbnN0cnVjdG9yKHBhcmFtcywgZm9ybUVsZW1lbnQpIHtcbiAgICAgICAgdGhpcy5fZm9ybUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGZvcm1FbGVtZW50KTtcbiAgICAgICAgdGhpcy5faW5wdXRTZWxlY3RvciA9IHBhcmFtcy5pbnB1dFNlbGVjdG9yO1xuICAgICAgICB0aGlzLl9zdWJtaXRCdXR0b25TZWxlY3RvciA9IHBhcmFtcy5zdWJtaXRCdXR0b25TZWxlY3RvcjtcbiAgICAgICAgdGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyA9IHBhcmFtcy5pbmFjdGl2ZUJ1dHRvbkNsYXNzO1xuICAgICAgICB0aGlzLl9pbnB1dEVycm9yQ2xhc3MgPSBwYXJhbXMuaW5wdXRFcnJvckNsYXNzO1xuICAgICAgICB0aGlzLl9lcnJvckNsYXNzID0gcGFyYW1zLmVycm9yQ2xhc3M7XG4gICAgfVxuXG4gICAgX3Nob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCwgZXJyb3JNZXNzYWdlKSB7XG4gICAgICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcblxuICAgICAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9lcnJvckNsYXNzKTtcbiAgICAgICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlO1xuICAgIH07XG5cbiAgICBfaGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KSB7XG4gICAgICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcblxuICAgICAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9lcnJvckNsYXNzKTtcbiAgICAgICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gJyc7XG4gICAgfTtcblxuICAgIF9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXRFbGVtZW50KSB7XG4gICAgICAgIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgICAgICAgICB0aGlzLl9zaG93SW5wdXRFcnJvcihpbnB1dEVsZW1lbnQsIGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIF9oYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSB7XG4gICAgICAgIHJldHVybiBpbnB1dExpc3Quc29tZSgoaW5wdXRFbGVtZW50KSA9PiAhaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKTtcbiAgICB9O1xuXG4gICAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50KSB7XG4gICAgICAgIGlmICh0aGlzLl9oYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xuICAgICAgICAgICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgICAgICAgICAgYnV0dG9uRWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCB0cnVlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICAgICAgICAgIGJ1dHRvbkVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgICAgICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5faW5wdXRTZWxlY3RvcikpO1xuICAgICAgICBjb25zdCBidXR0b25FbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLl9zdWJtaXRCdXR0b25TZWxlY3Rvcik7XG5cbiAgICAgICAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xuICAgICAgICAgICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgdGhpcy50b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGVuYWJsZVZhbGlkYXRpb24oKSB7XG4gICAgICAgIGNvbnN0IHN1Ym1pdEZvcm1IYW5kbGVyID0gKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLl9mb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIHN1Ym1pdEZvcm1IYW5kbGVyKTtcblxuICAgICAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xuICAgIH07XG59IiwiZXhwb3J0IGNsYXNzIFNlY3Rpb24ge1xuICAgIGNvbnN0cnVjdG9yKHsgaXRlbXMsIHJlbmRlcmVyIH0sIGNvbnRhaW5lclNlbGVjdG9yKSB7XG4gICAgICAgIHRoaXMuX3JlbmRlcmVkSXRlbXMgPSBpdGVtcztcbiAgICAgICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjtcblxuICAgICAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcbiAgICB9XG5cbiAgICByZW5kZXJJdGVtcygpIHtcbiAgICAgICAgdGhpcy5fcmVuZGVyZWRJdGVtcy5mb3JFYWNoKGl0ZW0gPT4gdGhpcy5fcmVuZGVyZXIoaXRlbSkpO1xuICAgIH1cblxuICAgIGFkZEl0ZW0oZWxlbWVudCkge1xuICAgICAgICB0aGlzLl9jb250YWluZXIucHJlcGVuZChlbGVtZW50KTtcbiAgICB9XG59XG5cbiIsIlxuZXhwb3J0IGNsYXNzIFBvcHVwIHtcbiAgICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XG4gICAgICAgIHRoaXMuX3BvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihwb3B1cFNlbGVjdG9yKTtcbiAgICAgICAgdGhpcy5faGFuZGxlRXNjQ2xvc2UgPSB0aGlzLl9oYW5kbGVFc2NDbG9zZS5iaW5kKHRoaXMpO1xuICAgIH1cblxuICAgIG9wZW4oKSB7XG4gICAgICAgIHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5hZGQoJ3BvcHVwX29wZW5lZCcpO1xuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xuICAgIH1cblxuICAgIGNsb3NlKCkge1xuICAgICAgICB0aGlzLl9wb3B1cC5jbGFzc0xpc3QucmVtb3ZlKCdwb3B1cF9vcGVuZWQnKTtcbiAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTsgXG4gICAgfVxuXG4gICAgX2hhbmRsZUVzY0Nsb3NlKCkge1xuICAgICAgICBpZiAodGhpcy5fcG9wdXAuY2xhc3NMaXN0LmNvbnRhaW5zKCdwb3B1cF9vcGVuZWQnKSkge1xuICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChldnQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXZ0LmtleSA9PT0gJ0VzY2FwZScpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChldnQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXZ0LmtleSA9PT0gJ0VzY2FwZScpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMocG9wdXApIHtcbiAgICAgICAgY29uc3QgcG9wdXBDbG9zZUJ1dHRvbiA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fY2xvc2UnKTtcbiAgICAgICAgcG9wdXBDbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHRoaXMuY2xvc2UoKSk7XG5cblxuICAgICAgICB0aGlzLl9wb3B1cC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldnQpID0+IHtcbiAgICAgICAgICAgIGlmIChldnQudGFyZ2V0ICE9PSBldnQuY3VycmVudFRhcmdldCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5jbG9zZShldnQuY3VycmVudFRhcmdldCk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbiIsImltcG9ydCB7IFBvcHVwIH0gZnJvbSAnLi9Qb3B1cC5qcyc7XG5cbmV4cG9ydCBjbGFzcyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwIHtcbiAgICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XG4gICAgICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xuICAgIH1cblxuICAgIG9wZW4obmFtZSwgbGluaykge1xuICAgICAgICB0aGlzLl9wb3B1cEltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX19pbWFnZScpO1xuICAgICAgICB0aGlzLl9wb3B1cFRpdGxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX19jYXB0aW9uJyk7XG4gICAgICAgIHRoaXMuX3BvcHVwSW1hZ2Uuc3JjID0gbGluaztcbiAgICAgICAgdGhpcy5fcG9wdXBUaXRsZSA9IG5hbWU7XG4gICAgICAgIHN1cGVyLm9wZW4oKTtcbiAgICB9XG59IiwiaW1wb3J0IHsgUG9wdXAgfSBmcm9tICcuL1BvcHVwLmpzJztcblxuZXhwb3J0IGNsYXNzIFBvcHVwV2l0aEZvcm0gZXh0ZW5kcyBQb3B1cCB7XG4gICAgY29uc3RydWN0b3IoeyBwb3B1cFNlbGVjdG9yLCBoYW5kbGVGb3JtU3VibWl0IH0pIHtcbiAgICAgICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XG4gICAgICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQgPSBoYW5kbGVGb3JtU3VibWl0O1xuICAgIH1cblxuICAgIF9nZXRJbnB1dFZhbHVlcygpIHtcbiAgICAgICAgY29uc3QgdXNlcklucHV0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wb3B1cF9fZmllbGQnKTtcbiAgICAgICAgdGhpcy5faW5wdXRWYWx1ZXMgPSB7fTtcbiAgICAgICAgdXNlcklucHV0cy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgICAgICB0aGlzLl9pbnB1dFZhbHVlc1tpdGVtLm5hbWVdID0gaXRlbS52YWx1ZTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLl9pbnB1dFZhbHVlcztcbiAgICB9XG5cbiAgICBjbG9zZSgpIHtcbiAgICAgICAgc3VwZXIuY2xvc2UoKTtcbiAgICAgICAgdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcignZm9ybScpLnJlc2V0KCk7IFxuICAgIH1cblxuICAgIHNldEV2ZW50TGlzdGVuZXJzKHBvcHVwKSB7XG4gICAgICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKHBvcHVwKTtcbiAgICAgICAgdGhpcy5fcG9wdXAuYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgKGV2dCkgPT4ge1xuICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0KHRoaXMuX2dldElucHV0VmFsdWVzKCkpO1xuICAgICAgICB9KVxuICAgIH1cbn1cblxuXG4iLCJleHBvcnQgY2xhc3MgVXNlckluZm8ge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLnRpdGxlU2VsZWN0b3IgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9fdGl0bGUnKTtcbiAgICAgICAgdGhpcy5zdWJ0aXRsZVNlbGVjdG9yID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX3N1YnRpdGxlJyk7XG4gICAgfVxuXG4gICAgZ2V0VXNlckluZm8oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBuYW1lOiB0aGlzLnRpdGxlU2VsZWN0b3IudGV4dENvbnRlbnQsXG4gICAgICAgICAgICBqb2JJbnB1dDogdGhpcy5zdWJ0aXRsZVNlbGVjdG9yLnRleHRDb250ZW50XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzZXRVc2VySW5mbyh7IG5hbWUsIGpvYiB9KSB7XG4gICAgICAgIHRoaXMudGl0bGVTZWxlY3Rvci50ZXh0Q29udGVudCA9IG5hbWU7XG4gICAgICAgIHRoaXMuc3VidGl0bGVTZWxlY3Rvci50ZXh0Q29udGVudCA9IGpvYjtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBDYXJkIH0gZnJvbSAnLi4vY29tcG9uZW50cy9DYXJkLmpzJztcbmltcG9ydCB7IGluaXRpYWxDYXJkcywgcGFyYW1zLCBwb3B1cEFkZCwgYWRkQ2FyZEJ1dHRvbiwgcHJvZmlsZUVkaXRCdXR0b24gfSBmcm9tICcuLi91dGlscy9jb25zdGFudC5qcyc7XG5pbXBvcnQgeyBGb3JtVmFsaWRhdG9yIH0gZnJvbSAnLi4vY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzJztcbmltcG9ydCB7IFNlY3Rpb24gfSBmcm9tICcuLi9jb21wb25lbnRzL1NlY3Rpb24uanMnO1xuaW1wb3J0IHsgUG9wdXBXaXRoSW1hZ2UgfSBmcm9tICcuLi9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzJztcbmltcG9ydCB7IFBvcHVwV2l0aEZvcm0gfSBmcm9tICcuLi9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanMnO1xuaW1wb3J0IHsgVXNlckluZm8gfSBmcm9tICcuLi9jb21wb25lbnRzL1VzZXJJbmZvLmpzJztcbmltcG9ydCAnLi9pbmRleC5jc3MnO1xuXG5jb25zdCB1c2VySW5mbyA9IG5ldyBVc2VySW5mbygpO1xuXG5jb25zdCBnZW5lcmF0ZUNhcmRUZW1wbGF0ZSA9ICgpID0+IGRvY3VtZW50XG4gICAgLnF1ZXJ5U2VsZWN0b3IoXCIjZWxlbWVudHNcIilcbiAgICAuY29udGVudFxuICAgIC5xdWVyeVNlbGVjdG9yKCcuZWxlbWVudF9fY2FyZHMnKVxuICAgIC5jbG9uZU5vZGUodHJ1ZSk7XG5cbmNvbnN0IHBvcHVwSW1hZ2UgPSBuZXcgUG9wdXBXaXRoSW1hZ2UoJy5wb3B1cF90eXBlX2ltZycpO1xucG9wdXBJbWFnZS5zZXRFdmVudExpc3RlbmVycygpO1xuXG5jb25zdCBoYW5kbGVDYXJkQ2xpY2sgPSAoeyBuYW1lLCBsaW5rIH0pID0+IHtcbiAgICBwb3B1cEltYWdlLm9wZW4obmFtZSwgbGluayk7XG59O1xuXG5jb25zdCBjYXJkc0xpc3QgPSBuZXcgU2VjdGlvbih7XG4gICAgaXRlbXM6IGluaXRpYWxDYXJkcyxcbiAgICByZW5kZXJlcjogKGl0ZW0pID0+IHtcbiAgICAgICAgY29uc3QgY2FyZCA9IG5ldyBDYXJkKGl0ZW0ubmFtZSwgaXRlbS5saW5rLCBnZW5lcmF0ZUNhcmRUZW1wbGF0ZSgpLCBoYW5kbGVDYXJkQ2xpY2spO1xuXG4gICAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZC5nZW5lcmF0ZUNhcmQoKTtcblxuICAgICAgICBjYXJkc0xpc3QuYWRkSXRlbShjYXJkRWxlbWVudCk7XG4gICAgfVxufSxcbiAgICAnLmVsZW1lbnQnXG4pO1xuXG5jYXJkc0xpc3QucmVuZGVySXRlbXMoKTtcblxuY29uc3QgZ2V0Q2FyZEVsZW1lbnQgPSAoeyBuYW1lLCBsaW5rIH0pID0+IHtcbiAgICBjb25zdCBjYXJkID0gbmV3IENhcmQobmFtZSwgbGluaywgZ2VuZXJhdGVDYXJkVGVtcGxhdGUoKSwgaGFuZGxlQ2FyZENsaWNrKTtcbiAgICByZXR1cm4gY2FyZC5nZW5lcmF0ZUNhcmQoKTtcbn1cblxuY29uc3QgZm9ybUFkZCA9IG5ldyBQb3B1cFdpdGhGb3JtKHtcbiAgICBwb3B1cFNlbGVjdG9yOiAnLnBvcHVwX3R5cGVfYWRkJyxcbiAgICBoYW5kbGVGb3JtU3VibWl0OiAoaW5wdXRWYWx1ZXMpID0+IHtcbiAgICAgICAgY2FyZExpc3QuYWRkSXRlbSh7IG5hbWU6IGlucHV0VmFsdWVzLnRpdGxlLCBsaW5rOiBpbnB1dFZhbHVlcy5waWN0dXJlIH0pO1xuICAgICAgICBmb3JtQWRkLmNsb3NlKCk7XG4gICAgfVxufSk7XG5cbmZvcm1BZGQuc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybUVkaXQpO1xuXG5hZGRDYXJkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgIGZvcm1BZGQub3BlbigpO1xuXG4gICAgY29uc3QgaW5wdXRMaXN0ID0gQXJyYXkuZnJvbShwb3B1cEFkZC5xdWVyeVNlbGVjdG9yQWxsKCcucG9wdXBfX2ZpZWxkJykpO1xuICAgIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSBwb3B1cEFkZC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX3N1Ym1pdC1idXR0b24nKTtcblxuICAgIGZvcm1BZGRWYWxpZGF0b3IudG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50KTtcbn0pO1xuXG5jb25zdCBmb3JtRWRpdCA9IG5ldyBQb3B1cFdpdGhGb3JtKHtcbiAgICBwb3B1cFNlbGVjdG9yOiAnLnBvcHVwX3R5cGVfZWRpdCcsXG4gICAgaGFuZGxlRm9ybVN1Ym1pdDogKGlucHV0c1ZhbHVlcykgPT4ge1xuICAgICAgICB1c2VySW5mby5zZXRVc2VySW5mbyh7IG5hbWU6IGlucHV0c1ZhbHVlcy5mdWxsbmFtZSwgam9iOiBpbnB1dHNWYWx1ZXMuam9iIH0pO1xuICAgICAgICBmb3JtRWRpdC5jbG9zZSgpO1xuICAgIH1cblxufSk7XG5cbnByb2ZpbGVFZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgIGNvbnN0IHByb2ZpbGUgPSB1c2VySW5mby5nZXRVc2VySW5mbygpO1xuICAgIGNvbnN0IGlucHV0c05hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2ZpZWxkX2lucHV0X25hbWUnKTtcbiAgICBjb25zdCBpbnB1dHNKb2IgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2ZpZWxkX2lucHV0X2pvYicpO1xuXG4gICAgaW5wdXRzTmFtZS52YWx1ZSA9IHByb2ZpbGUubmFtZTtcbiAgICBpbnB1dHNKb2IudmFsdWUgPSBwcm9maWxlLmpvYklucHV0O1xuXG4gICAgZm9ybUVkaXQub3BlbigpO1xufSk7XG5cbmZvcm1FZGl0LnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbmNvbnN0IGZvcm1BZGRWYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihwYXJhbXMsIHBhcmFtcy5mb3JtQWRkKTtcbmZvcm1BZGRWYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuXG5jb25zdCBmb3JtRWRpdFZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKHBhcmFtcywgcGFyYW1zLmZvcm1FZGl0KTtcbmZvcm1FZGl0VmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcblxuXG4iXSwic291cmNlUm9vdCI6IiJ9