(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var t=function(){function t(e,n,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._name=e,this._link=n,this._template=r,this._handleCardClick=o}var n,r;return n=t,(r=[{key:"generateCard",value:function(){return this._element=this._template,this._image=this._element.querySelector(".element__image"),this._image.src=this._link,this._image.alt=this._name,this._element.querySelector(".element__title").textContent=this._name,this._setEventListeners(),this._element}},{key:"_handleDeleteCard",value:function(){this._element.remove()}},{key:"_setEventListeners",value:function(){var e=this;this._element.querySelector(".element__delete-button").addEventListener("click",(function(){e._handleDeleteCard()})),this._element.querySelector(".element__like-image").addEventListener("click",(function(e){e.target.classList.toggle("element__like-image-active")})),this._image.addEventListener("click",(function(){return e._handleCardClick(e)}))}}])&&e(n.prototype,r),t}(),n={formSelector:".popup__form",inputSelector:".popup__field",formAdd:".popup_type_add",formEdit:".popup_type_edit",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button-disabled",inputErrorClass:"popup__field-error",errorClass:"popup__field-error-active"},r=document.querySelector(".popup__image"),o=document.querySelector(".popup__caption"),i=document.querySelector(".popup_type_add"),u=document.querySelector(".profile__edit-button"),c=document.querySelector(".profile__add-button");function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._formElement=document.querySelector(n),this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._inactiveButtonClass=t.inactiveButtonClass,this._inputErrorClass=t.inputErrorClass,this._errorClass=t.errorClass}var t,n;return t=e,(n=[{key:"_showInputError",value:function(e,t){var n=this._formElement.querySelector("#".concat(e.id,"-error"));n.classList.add(this._errorClass),n.textContent=t}},{key:"_hideInputError",value:function(e){var t=this._formElement.querySelector("#".concat(e.id,"-error"));e.classList.remove(this._errorClass),t.textContent=""}},{key:"_checkInputValidity",value:function(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}},{key:"_hasInvalidInput",value:function(e){return e.some((function(e){return!e.validity.valid}))}},{key:"toggleButtonState",value:function(e,t){this._hasInvalidInput(e)?(t.classList.add(this._inactiveButtonClass),t.setAttribute("disabled",!0)):(t.classList.remove(this._inactiveButtonClass),t.removeAttribute("disabled"))}},{key:"_setEventListeners",value:function(){var e=this,t=Array.from(this._formElement.querySelectorAll(this._inputSelector)),n=this._formElement.querySelector(this._submitButtonSelector);t.forEach((function(r){r.addEventListener("input",(function(){e._checkInputValidity(r),e.toggleButtonState(t,n)}))}))}},{key:"enableValidation",value:function(){this._formElement.addEventListener("submit",(function(e){e.preventDefault()})),this._setEventListeners()}}])&&l(t.prototype,n),e}();function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=function(){function e(t,n){var r=t.items,o=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._renderedItems=r,this._renderer=o,this._container=document.querySelector(n)}var t,n;return t=e,(n=[{key:"renderItems",value:function(){var e=this;this._renderedItems.forEach((function(t){return e._renderer(t)}))}},{key:"addItem",value:function(e){this._container.prepend(e)}}])&&s(t.prototype,n),e}();function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popup=document.querySelector(t),this.setEventListeners(this)}var t,n;return t=e,(n=[{key:"open",value:function(){this._popup.classList.add("popup_opened")}},{key:"close",value:function(){this._popup.classList.remove("popup_opened")}},{key:"_handleEscClose",value:function(){var e=this;this._popup.classList.contains("popup_opened")?document.addEventListener("keydown",(function(t){"Escape"===t.key&&(document.querySelector(".popup_opened"),e.close())})):document.removeEventListener("keydown",(function(t){"Escape"===t.key&&(document.querySelector(".popup_opened"),e.close())}))}},{key:"setEventListeners",value:function(e){var t=this;this._popup.querySelector(".popup__close").addEventListener("click",(function(){return e.close()})),this._popup.addEventListener("click",(function(e){e.target===e.currentTarget&&t.close(e.currentTarget)})),document.addEventListener("keydown",(function(){return t._handleEscClose(e)}))}}])&&f(t.prototype,n),e}();function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t,n){return(m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=b(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var k=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(l,e);var t,n,i,u,c=(i=l,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=b(i);if(u){var n=b(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return v(this,e)});function l(e,t){var n,r=e.name,o=e.link;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(n=c.call(this,t))._name=r,n._link=o,n}return t=l,(n=[{key:"open",value:function(){m(b(l.prototype),"open",this).call(this),r.src=this._link,o.textContent=this._name}}])&&_(t.prototype,n),l}(d);function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function E(e,t,n){return(E="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=j(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function C(e,t){return!t||"object"!==S(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var O=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=j(r);if(o){var n=j(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return C(this,e)});function u(e){var t,n=e.popupSelector,r=e.popupField,o=e.handleFormSubmit;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=i.call(this,n))._handleFormSubmit=o,t._popupField=document.querySelectorAll(r),t}return t=u,(n=[{key:"_getInputValues",value:function(){var e=this,t=document.querySelectorAll(".popup__field");return this._inputValues={},t.forEach((function(t){e._inputValues[t.name]=t.value})),this._inputValues}},{key:"close",value:function(){E(j(u.prototype),"close",this).call(this),document.querySelectorAll(".popup__form").forEach((function(e){return e.reset()}))}},{key:"open",value:function(){E(j(u.prototype),"open",this).call(this)}},{key:"setEventListeners",value:function(e){var t=this;E(j(u.prototype),"setEventListeners",this).call(this,e),this._popup.addEventListener("submit",(function(e){e.preventDefault(),t._handleFormSubmit(t._getInputValues())}))}}])&&g(t.prototype,n),u}(d);function L(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var q=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.titleSelector=document.querySelector(".profile__title"),this.subtitleSelector=document.querySelector(".profile__subtitle")}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return{name:this.titleSelector.textContent,jobInput:this.subtitleSelector.textContent}}},{key:"setUserInfo",value:function(e){var t=e.name,n=e.job;this.titleSelector.textContent=t,this.subtitleSelector.textContent=n}}])&&L(t.prototype,n),e}()),I=function(e){new k({name:e._name,link:e._link},".popup_type_img").open()},P=new p({items:[{name:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{name:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{name:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{name:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{name:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{name:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}],renderer:function(e){var n=new t(e.name,e.link,document.querySelector("#elements").content.querySelector(".element__cards").cloneNode(!0),I).generateCard();P.addItem(n),I.bind(e)}},".element");P.renderItems();var x=new O({popupSelector:".popup_type_add",popupField:".popup__field",handleFormSubmit:function(e){P._renderer({name:e.title,link:e.picture}),x.close()}});c.addEventListener("click",(function(){x.open();var e=Array.from(i.querySelectorAll(".popup__field")),t=i.querySelector(".popup__submit-button");B.toggleButtonState(e,t)}));var R=new O({popupSelector:".popup_type_edit",popupField:".popup__field",handleFormSubmit:function(e){q.setUserInfo({name:e.fullname,job:e.job}),R.close()}});u.addEventListener("click",(function(){var e=q.getUserInfo();R._popupField[0].value=e.name,R._popupField[1].value=e.jobInput,R.open()}));var B=new a(n,n.formAdd);B.enableValidation(),new a(n,n.formEdit).enableValidation()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tZXN0by8uL3NyYy9jb21wb25lbnRzL0NhcmQuanMiLCJ3ZWJwYWNrOi8vbWVzdG8vLi9zcmMvdXRpbHMvY29uc3RhbnQuanMiLCJ3ZWJwYWNrOi8vbWVzdG8vLi9zcmMvY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL21lc3RvLy4vc3JjL2NvbXBvbmVudHMvU2VjdGlvbi5qcyIsIndlYnBhY2s6Ly9tZXN0by8uL3NyYy9jb21wb25lbnRzL1BvcHVwLmpzIiwid2VicGFjazovL21lc3RvLy4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanMiLCJ3ZWJwYWNrOi8vbWVzdG8vLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL21lc3RvLy4vc3JjL2NvbXBvbmVudHMvVXNlckluZm8uanMiLCJ3ZWJwYWNrOi8vbWVzdG8vLi9zcmMvcGFnZXMvaW5kZXguanMiXSwibmFtZXMiOlsiQ2FyZCIsIm5hbWUiLCJsaW5rIiwidGVtcGxhdGUiLCJoYW5kbGVDYXJkQ2xpY2siLCJ0aGlzIiwiX25hbWUiLCJfbGluayIsIl90ZW1wbGF0ZSIsIl9oYW5kbGVDYXJkQ2xpY2siLCJfZWxlbWVudCIsIl9pbWFnZSIsInF1ZXJ5U2VsZWN0b3IiLCJzcmMiLCJhbHQiLCJ0ZXh0Q29udGVudCIsIl9zZXRFdmVudExpc3RlbmVycyIsInJlbW92ZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJfaGFuZGxlRGVsZXRlQ2FyZCIsImV2ZW50IiwidGFyZ2V0IiwiY2xhc3NMaXN0IiwidG9nZ2xlIiwicGFyYW1zIiwiZm9ybVNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsImZvcm1BZGQiLCJmb3JtRWRpdCIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsImlucHV0RXJyb3JDbGFzcyIsImVycm9yQ2xhc3MiLCJwb3B1cEltYWdlIiwiZG9jdW1lbnQiLCJwb3B1cFRpdGxlIiwicG9wdXBBZGQiLCJwcm9maWxlRWRpdEJ1dHRvbiIsImFkZENhcmRCdXR0b24iLCJGb3JtVmFsaWRhdG9yIiwiZm9ybUVsZW1lbnQiLCJfZm9ybUVsZW1lbnQiLCJfaW5wdXRTZWxlY3RvciIsIl9zdWJtaXRCdXR0b25TZWxlY3RvciIsIl9pbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiX2lucHV0RXJyb3JDbGFzcyIsIl9lcnJvckNsYXNzIiwiaW5wdXRFbGVtZW50IiwiZXJyb3JNZXNzYWdlIiwiZXJyb3JFbGVtZW50IiwiaWQiLCJhZGQiLCJ2YWxpZGl0eSIsInZhbGlkIiwiX2hpZGVJbnB1dEVycm9yIiwiX3Nob3dJbnB1dEVycm9yIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJpbnB1dExpc3QiLCJzb21lIiwiYnV0dG9uRWxlbWVudCIsIl9oYXNJbnZhbGlkSW5wdXQiLCJzZXRBdHRyaWJ1dGUiLCJyZW1vdmVBdHRyaWJ1dGUiLCJBcnJheSIsImZyb20iLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsIl9jaGVja0lucHV0VmFsaWRpdHkiLCJ0b2dnbGVCdXR0b25TdGF0ZSIsInByZXZlbnREZWZhdWx0IiwiU2VjdGlvbiIsImNvbnRhaW5lclNlbGVjdG9yIiwiaXRlbXMiLCJyZW5kZXJlciIsIl9yZW5kZXJlZEl0ZW1zIiwiX3JlbmRlcmVyIiwiX2NvbnRhaW5lciIsIml0ZW0iLCJlbGVtZW50IiwicHJlcGVuZCIsIlBvcHVwIiwicG9wdXBTZWxlY3RvciIsIl9wb3B1cCIsInNldEV2ZW50TGlzdGVuZXJzIiwiY29udGFpbnMiLCJldnQiLCJrZXkiLCJjbG9zZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJwb3B1cCIsImN1cnJlbnRUYXJnZXQiLCJfaGFuZGxlRXNjQ2xvc2UiLCJQb3B1cFdpdGhJbWFnZSIsIlBvcHVwV2l0aEZvcm0iLCJwb3B1cEZpZWxkIiwiaGFuZGxlRm9ybVN1Ym1pdCIsIl9oYW5kbGVGb3JtU3VibWl0IiwiX3BvcHVwRmllbGQiLCJ1c2VySW5wdXRzIiwiX2lucHV0VmFsdWVzIiwidmFsdWUiLCJmb3JtIiwicmVzZXQiLCJfZ2V0SW5wdXRWYWx1ZXMiLCJ1c2VySW5mbyIsInRpdGxlU2VsZWN0b3IiLCJzdWJ0aXRsZVNlbGVjdG9yIiwiam9iSW5wdXQiLCJqb2IiLCJjYXJkIiwib3BlbiIsImNhcmRzTGlzdCIsImNhcmRFbGVtZW50IiwiY29udGVudCIsImNsb25lTm9kZSIsImdlbmVyYXRlQ2FyZCIsImFkZEl0ZW0iLCJiaW5kIiwicmVuZGVySXRlbXMiLCJpbnB1dFZhbHVlcyIsInRpdGxlIiwicGljdHVyZSIsImZvcm1BZGRWYWxpZGF0b3IiLCJpbnB1dHNWYWx1ZXMiLCJzZXRVc2VySW5mbyIsImZ1bGxuYW1lIiwicHJvZmlsZSIsImdldFVzZXJJbmZvIiwiZW5hYmxlVmFsaWRhdGlvbiJdLCJtYXBwaW5ncyI6InlMQUFPLElBQU1BLEVBQWIsV0FDSSxXQUFZQyxFQUFNQyxFQUFNQyxFQUFVQyxJLDRGQUFpQixTQUMvQ0MsS0FBS0MsTUFBUUwsRUFDYkksS0FBS0UsTUFBUUwsRUFDYkcsS0FBS0csVUFBWUwsRUFDakJFLEtBQUtJLGlCQUFtQkwsRSxRQUxoQyxPLEVBQUEsRyxFQUFBLHNDQWlCUSxPQVJBQyxLQUFLSyxTQUFXTCxLQUFLRyxVQUNyQkgsS0FBS00sT0FBU04sS0FBS0ssU0FBU0UsY0FBYyxtQkFDMUNQLEtBQUtNLE9BQU9FLElBQU1SLEtBQUtFLE1BQ3ZCRixLQUFLTSxPQUFPRyxJQUFNVCxLQUFLQyxNQUN2QkQsS0FBS0ssU0FBU0UsY0FBYyxtQkFBbUJHLFlBQWNWLEtBQUtDLE1BRWxFRCxLQUFLVyxxQkFFRVgsS0FBS0ssV0FqQnBCLDBDQXFCUUwsS0FBS0ssU0FBU08sV0FyQnRCLDJDQXdCeUIsV0FDakJaLEtBQUtLLFNBQ0FFLGNBQWMsMkJBQ2RNLGlCQUFpQixTQUFTLFdBQ3ZCLEVBQUtDLHVCQUdiZCxLQUFLSyxTQUNBRSxjQUFjLHdCQUNkTSxpQkFBaUIsU0FBUyxTQUFBRSxHQUN2QkEsRUFBTUMsT0FBT0MsVUFBVUMsT0FBTyxpQ0FHdENsQixL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dEIsRUFBU3VCLGNBRXpCbkcsRUFBU3FFLFlBQVksR0FBR0csTUFBUTBCLEVBQVE3SCxLQUN4QzJCLEVBQVNxRSxZQUFZLEdBQUdHLE1BQVEwQixFQUFRbkIsU0FFeEMvRSxFQUFTa0YsVUFHYixJQUFNWSxFQUFtQixJQUFJbkYsRUFBY2YsRUFBUUEsRUFBT0csU0FDMUQrRixFQUFpQk0sbUJBRVMsSUFBSXpGLEVBQWNmLEVBQVFBLEVBQU9JLFVBQ3pDb0csb0IiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjbGFzcyBDYXJkIHtcbiAgICBjb25zdHJ1Y3RvcihuYW1lLCBsaW5rLCB0ZW1wbGF0ZSwgaGFuZGxlQ2FyZENsaWNrKSB7XG4gICAgICAgIHRoaXMuX25hbWUgPSBuYW1lO1xuICAgICAgICB0aGlzLl9saW5rID0gbGluaztcbiAgICAgICAgdGhpcy5fdGVtcGxhdGUgPSB0ZW1wbGF0ZTtcbiAgICAgICAgdGhpcy5faGFuZGxlQ2FyZENsaWNrID0gaGFuZGxlQ2FyZENsaWNrO1xuICAgIH1cblxuICAgIGdlbmVyYXRlQ2FyZCgpIHtcbiAgICAgICAgdGhpcy5fZWxlbWVudCA9IHRoaXMuX3RlbXBsYXRlO1xuICAgICAgICB0aGlzLl9pbWFnZSA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcignLmVsZW1lbnRfX2ltYWdlJyk7XG4gICAgICAgIHRoaXMuX2ltYWdlLnNyYyA9IHRoaXMuX2xpbms7XG4gICAgICAgIHRoaXMuX2ltYWdlLmFsdCA9IHRoaXMuX25hbWU7XG4gICAgICAgIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcignLmVsZW1lbnRfX3RpdGxlJykudGV4dENvbnRlbnQgPSB0aGlzLl9uYW1lO1xuXG4gICAgICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuX2VsZW1lbnQ7XG4gICAgfVxuXG4gICAgX2hhbmRsZURlbGV0ZUNhcmQoKSB7XG4gICAgICAgIHRoaXMuX2VsZW1lbnQucmVtb3ZlKCk7XG4gICAgfVxuXG4gICAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgICAgICB0aGlzLl9lbGVtZW50XG4gICAgICAgICAgICAucXVlcnlTZWxlY3RvcignLmVsZW1lbnRfX2RlbGV0ZS1idXR0b24nKVxuICAgICAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZURlbGV0ZUNhcmQoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuX2VsZW1lbnRcbiAgICAgICAgICAgIC5xdWVyeVNlbGVjdG9yKCcuZWxlbWVudF9fbGlrZS1pbWFnZScpXG4gICAgICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBldmVudCA9PiB7XG4gICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC50b2dnbGUoJ2VsZW1lbnRfX2xpa2UtaW1hZ2UtYWN0aXZlJyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLl9pbWFnZVxuICAgICAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gdGhpcy5faGFuZGxlQ2FyZENsaWNrKHRoaXMpKTtcbiAgICB9XG59ICIsImV4cG9ydCBjb25zdCBpbml0aWFsQ2FyZHMgPSBbXG4gICAge1xuICAgICAgICBuYW1lOiAn0JDRgNGF0YvQtycsXG4gICAgICAgIGxpbms6ICdodHRwczovL3BpY3R1cmVzLnMzLnlhbmRleC5uZXQvZnJvbnRlbmQtZGV2ZWxvcGVyL2NhcmRzLWNvbXByZXNzZWQvYXJraHl6LmpwZydcbiAgICB9LFxuICAgIHtcbiAgICAgICAgbmFtZTogJ9Cn0LXQu9GP0LHQuNC90YHQutCw0Y8g0L7QsdC70LDRgdGC0YwnLFxuICAgICAgICBsaW5rOiAnaHR0cHM6Ly9waWN0dXJlcy5zMy55YW5kZXgubmV0L2Zyb250ZW5kLWRldmVsb3Blci9jYXJkcy1jb21wcmVzc2VkL2NoZWx5YWJpbnNrLW9ibGFzdC5qcGcnXG4gICAgfSxcbiAgICB7XG4gICAgICAgIG5hbWU6ICfQmNCy0LDQvdC+0LLQvicsXG4gICAgICAgIGxpbms6ICdodHRwczovL3BpY3R1cmVzLnMzLnlhbmRleC5uZXQvZnJvbnRlbmQtZGV2ZWxvcGVyL2NhcmRzLWNvbXByZXNzZWQvaXZhbm92by5qcGcnXG4gICAgfSxcbiAgICB7XG4gICAgICAgIG5hbWU6ICfQmtCw0LzRh9Cw0YLQutCwJyxcbiAgICAgICAgbGluazogJ2h0dHBzOi8vcGljdHVyZXMuczMueWFuZGV4Lm5ldC9mcm9udGVuZC1kZXZlbG9wZXIvY2FyZHMtY29tcHJlc3NlZC9rYW1jaGF0a2EuanBnJ1xuICAgIH0sXG4gICAge1xuICAgICAgICBuYW1lOiAn0KXQvtC70LzQvtCz0L7RgNGB0LrQuNC5INGA0LDQudC+0L0nLFxuICAgICAgICBsaW5rOiAnaHR0cHM6Ly9waWN0dXJlcy5zMy55YW5kZXgubmV0L2Zyb250ZW5kLWRldmVsb3Blci9jYXJkcy1jb21wcmVzc2VkL2tob2xtb2dvcnNreS1yYXlvbi5qcGcnXG4gICAgfSxcbiAgICB7XG4gICAgICAgIG5hbWU6ICfQkdCw0LnQutCw0LsnLFxuICAgICAgICBsaW5rOiAnaHR0cHM6Ly9waWN0dXJlcy5zMy55YW5kZXgubmV0L2Zyb250ZW5kLWRldmVsb3Blci9jYXJkcy1jb21wcmVzc2VkL2JhaWthbC5qcGcnXG4gICAgfVxuXTtcblxuZXhwb3J0IGNvbnN0IHBhcmFtcyA9IHtcbiAgICBmb3JtU2VsZWN0b3I6ICcucG9wdXBfX2Zvcm0nLFxuICAgIGlucHV0U2VsZWN0b3I6ICcucG9wdXBfX2ZpZWxkJyxcbiAgICBmb3JtQWRkOiAnLnBvcHVwX3R5cGVfYWRkJyxcbiAgICBmb3JtRWRpdDogJy5wb3B1cF90eXBlX2VkaXQnLFxuICAgIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiAnLnBvcHVwX19zdWJtaXQtYnV0dG9uJyxcbiAgICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiAncG9wdXBfX3N1Ym1pdC1idXR0b24tZGlzYWJsZWQnLFxuICAgIGlucHV0RXJyb3JDbGFzczogJ3BvcHVwX19maWVsZC1lcnJvcicsXG4gICAgZXJyb3JDbGFzczogJ3BvcHVwX19maWVsZC1lcnJvci1hY3RpdmUnXG59XG5cbmV4cG9ydCBjb25zdCBwb3B1cEltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX19pbWFnZScpO1xuZXhwb3J0IGNvbnN0IHBvcHVwVGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2NhcHRpb24nKTtcblxuZXhwb3J0IGNvbnN0IHBvcHVwQWRkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX3R5cGVfYWRkJyk7XG5cbmV4cG9ydCBjb25zdCBwcm9maWxlRWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19lZGl0LWJ1dHRvbicpO1xuZXhwb3J0IGNvbnN0IGFkZENhcmRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9fYWRkLWJ1dHRvbicpOyIsImV4cG9ydCBjbGFzcyBGb3JtVmFsaWRhdG9yIHtcbiAgICBjb25zdHJ1Y3RvcihwYXJhbXMsIGZvcm1FbGVtZW50KSB7XG4gICAgICAgIHRoaXMuX2Zvcm1FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihmb3JtRWxlbWVudCk7XG4gICAgICAgIHRoaXMuX2lucHV0U2VsZWN0b3IgPSBwYXJhbXMuaW5wdXRTZWxlY3RvcjtcbiAgICAgICAgdGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3IgPSBwYXJhbXMuc3VibWl0QnV0dG9uU2VsZWN0b3I7XG4gICAgICAgIHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MgPSBwYXJhbXMuaW5hY3RpdmVCdXR0b25DbGFzcztcbiAgICAgICAgdGhpcy5faW5wdXRFcnJvckNsYXNzID0gcGFyYW1zLmlucHV0RXJyb3JDbGFzcztcbiAgICAgICAgdGhpcy5fZXJyb3JDbGFzcyA9IHBhcmFtcy5lcnJvckNsYXNzO1xuICAgIH1cblxuICAgIF9zaG93SW5wdXRFcnJvcihpbnB1dEVsZW1lbnQsIGVycm9yTWVzc2FnZSkge1xuICAgICAgICBjb25zdCBlcnJvckVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYCk7XG5cbiAgICAgICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fZXJyb3JDbGFzcyk7XG4gICAgICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IGVycm9yTWVzc2FnZTtcbiAgICB9O1xuXG4gICAgX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCkge1xuICAgICAgICBjb25zdCBlcnJvckVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYCk7XG5cbiAgICAgICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fZXJyb3JDbGFzcyk7XG4gICAgICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9ICcnO1xuICAgIH07XG5cbiAgICBfY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCkge1xuICAgICAgICBpZiAoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xuICAgICAgICAgICAgdGhpcy5fc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50LCBpbnB1dEVsZW1lbnQudmFsaWRhdGlvbk1lc3NhZ2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBfaGFzSW52YWxpZElucHV0KGlucHV0TGlzdCkge1xuICAgICAgICByZXR1cm4gaW5wdXRMaXN0LnNvbWUoKGlucHV0RWxlbWVudCkgPT4gIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCk7XG4gICAgfTtcblxuICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCkge1xuICAgICAgICBpZiAodGhpcy5faGFzSW52YWxpZElucHV0KGlucHV0TGlzdCkpIHtcbiAgICAgICAgICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICAgICAgICAgIGJ1dHRvbkVsZW1lbnQuc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgICAgICAgICBidXR0b25FbGVtZW50LnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIF9zZXRFdmVudExpc3RlbmVycygpIHtcbiAgICAgICAgY29uc3QgaW5wdXRMaXN0ID0gQXJyYXkuZnJvbSh0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX2lucHV0U2VsZWN0b3IpKTtcbiAgICAgICAgY29uc3QgYnV0dG9uRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuXG4gICAgICAgIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICAgICAgICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBlbmFibGVWYWxpZGF0aW9uKCkge1xuICAgICAgICBjb25zdCBzdWJtaXRGb3JtSGFuZGxlciA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5fZm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBzdWJtaXRGb3JtSGFuZGxlcik7XG5cbiAgICAgICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgICB9O1xufSIsImV4cG9ydCBjbGFzcyBTZWN0aW9uIHtcbiAgICBjb25zdHJ1Y3Rvcih7IGl0ZW1zLCByZW5kZXJlciB9LCBjb250YWluZXJTZWxlY3Rvcikge1xuICAgICAgICB0aGlzLl9yZW5kZXJlZEl0ZW1zID0gaXRlbXM7XG4gICAgICAgIHRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7XG5cbiAgICAgICAgdGhpcy5fY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJTZWxlY3Rvcik7XG4gICAgfVxuXG4gICAgcmVuZGVySXRlbXMoKSB7XG4gICAgICAgIHRoaXMuX3JlbmRlcmVkSXRlbXMuZm9yRWFjaChpdGVtID0+IHRoaXMuX3JlbmRlcmVyKGl0ZW0pKTtcbiAgICB9XG5cbiAgICBhZGRJdGVtKGVsZW1lbnQpIHtcbiAgICAgICAgdGhpcy5fY29udGFpbmVyLnByZXBlbmQoZWxlbWVudCk7XG4gICAgfVxufVxuXG4iLCJcbmV4cG9ydCBjbGFzcyBQb3B1cCB7XG4gICAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xuICAgICAgICB0aGlzLl9wb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocG9wdXBTZWxlY3Rvcik7XG4gICAgICAgIHRoaXMuc2V0RXZlbnRMaXN0ZW5lcnModGhpcyk7XG4gICAgfVxuXG4gICAgb3BlbigpIHtcbiAgICAgICAgdGhpcy5fcG9wdXAuY2xhc3NMaXN0LmFkZCgncG9wdXBfb3BlbmVkJyk7XG4gICAgfVxuXG4gICAgY2xvc2UoKSB7XG4gICAgICAgIHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5yZW1vdmUoJ3BvcHVwX29wZW5lZCcpO1xuICAgIH1cblxuICAgIF9oYW5kbGVFc2NDbG9zZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5jb250YWlucygncG9wdXBfb3BlbmVkJykpIHtcbiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoZXZ0KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGV2dC5rZXkgPT09ICdFc2NhcGUnKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBvcHVwT3BlbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9vcGVuZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChldnQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXZ0LmtleSA9PT0gJ0VzY2FwZScpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcG9wdXBPcGVuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX29wZW5lZCcpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzZXRFdmVudExpc3RlbmVycyhwb3B1cCkge1xuICAgICAgICBjb25zdCBwb3B1cENsb3NlQnV0dG9uID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcignLnBvcHVwX19jbG9zZScpO1xuICAgICAgICBwb3B1cENsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gcG9wdXAuY2xvc2UoKSk7XG5cblxuICAgICAgICB0aGlzLl9wb3B1cC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldnQpID0+IHtcbiAgICAgICAgICAgIGlmIChldnQudGFyZ2V0ICE9PSBldnQuY3VycmVudFRhcmdldCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5jbG9zZShldnQuY3VycmVudFRhcmdldCk7XG4gICAgICAgIH0pO1xuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgKCkgPT4gdGhpcy5faGFuZGxlRXNjQ2xvc2UocG9wdXApKTtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBQb3B1cCB9IGZyb20gJy4vUG9wdXAuanMnO1xuaW1wb3J0IHsgcG9wdXBJbWFnZSwgcG9wdXBUaXRsZSB9IGZyb20gJy4uL3V0aWxzL2NvbnN0YW50LmpzJztcblxuZXhwb3J0IGNsYXNzIFBvcHVwV2l0aEltYWdlIGV4dGVuZHMgUG9wdXAge1xuICAgIGNvbnN0cnVjdG9yKHsgbmFtZSwgbGluayB9LCBwb3B1cFNlbGVjdG9yKSB7XG4gICAgICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xuICAgICAgICB0aGlzLl9uYW1lID0gbmFtZTtcbiAgICAgICAgdGhpcy5fbGluayA9IGxpbms7XG4gICAgfVxuXG4gICAgb3BlbigpIHtcbiAgICAgICAgc3VwZXIub3BlbigpO1xuICAgICAgICBwb3B1cEltYWdlLnNyYyA9IHRoaXMuX2xpbms7XG4gICAgICAgIHBvcHVwVGl0bGUudGV4dENvbnRlbnQgPSB0aGlzLl9uYW1lO1xuICAgIH1cbn0iLCJpbXBvcnQgeyBQb3B1cCB9IGZyb20gJy4vUG9wdXAuanMnO1xuXG5leHBvcnQgY2xhc3MgUG9wdXBXaXRoRm9ybSBleHRlbmRzIFBvcHVwIHtcbiAgICBjb25zdHJ1Y3Rvcih7IHBvcHVwU2VsZWN0b3IsIHBvcHVwRmllbGQsIGhhbmRsZUZvcm1TdWJtaXQgfSkge1xuICAgICAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcbiAgICAgICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCA9IGhhbmRsZUZvcm1TdWJtaXQ7XG4gICAgICAgIHRoaXMuX3BvcHVwRmllbGQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHBvcHVwRmllbGQpO1xuICAgIH1cblxuICAgIF9nZXRJbnB1dFZhbHVlcygpIHtcbiAgICAgICAgY29uc3QgdXNlcklucHV0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wb3B1cF9fZmllbGQnKTtcbiAgICAgICAgdGhpcy5faW5wdXRWYWx1ZXMgPSB7fTtcbiAgICAgICAgdXNlcklucHV0cy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgICAgICB0aGlzLl9pbnB1dFZhbHVlc1tpdGVtLm5hbWVdID0gaXRlbS52YWx1ZTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLl9pbnB1dFZhbHVlcztcbiAgICB9XG5cbiAgICBjbG9zZSgpIHtcbiAgICAgICAgc3VwZXIuY2xvc2UoKTtcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBvcHVwX19mb3JtJykuZm9yRWFjaCgoZm9ybSkgPT4gZm9ybS5yZXNldCgpKTtcbiAgICB9XG5cbiAgICBvcGVuKCkge1xuICAgICAgICBzdXBlci5vcGVuKCk7XG4gICAgfVxuXG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMocG9wdXApIHtcbiAgICAgICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMocG9wdXApO1xuICAgICAgICB0aGlzLl9wb3B1cC5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCAoZXZ0KSA9PiB7XG4gICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQodGhpcy5fZ2V0SW5wdXRWYWx1ZXMoKSk7XG4gICAgICAgIH0pXG4gICAgfVxufVxuXG5cbiIsImV4cG9ydCBjbGFzcyBVc2VySW5mbyB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMudGl0bGVTZWxlY3RvciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX190aXRsZScpO1xuICAgICAgICB0aGlzLnN1YnRpdGxlU2VsZWN0b3IgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9fc3VidGl0bGUnKTtcbiAgICB9XG5cbiAgICBnZXRVc2VySW5mbygpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG5hbWU6IHRoaXMudGl0bGVTZWxlY3Rvci50ZXh0Q29udGVudCxcbiAgICAgICAgICAgIGpvYklucHV0OiB0aGlzLnN1YnRpdGxlU2VsZWN0b3IudGV4dENvbnRlbnRcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHNldFVzZXJJbmZvKHsgbmFtZSwgam9iIH0pIHtcbiAgICAgICAgdGhpcy50aXRsZVNlbGVjdG9yLnRleHRDb250ZW50ID0gbmFtZTtcbiAgICAgICAgdGhpcy5zdWJ0aXRsZVNlbGVjdG9yLnRleHRDb250ZW50ID0gam9iO1xuICAgIH1cbn1cbiIsImltcG9ydCB7IENhcmQgfSBmcm9tICcuLi9jb21wb25lbnRzL0NhcmQuanMnO1xuaW1wb3J0IHsgaW5pdGlhbENhcmRzLCBwYXJhbXMsIHBvcHVwQWRkLCBhZGRDYXJkQnV0dG9uLCBwcm9maWxlRWRpdEJ1dHRvbiB9IGZyb20gJy4uL3V0aWxzL2NvbnN0YW50LmpzJztcbmltcG9ydCB7IEZvcm1WYWxpZGF0b3IgfSBmcm9tICcuLi9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanMnO1xuaW1wb3J0IHsgU2VjdGlvbiB9IGZyb20gJy4uL2NvbXBvbmVudHMvU2VjdGlvbi5qcyc7XG5pbXBvcnQgeyBQb3B1cFdpdGhJbWFnZSB9IGZyb20gJy4uL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanMnO1xuaW1wb3J0IHsgUG9wdXBXaXRoRm9ybSB9IGZyb20gJy4uL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qcyc7XG5pbXBvcnQgeyBVc2VySW5mbyB9IGZyb20gJy4uL2NvbXBvbmVudHMvVXNlckluZm8uanMnO1xuaW1wb3J0ICcuL2luZGV4LmNzcyc7XG5cbmNvbnN0IHVzZXJJbmZvID0gbmV3IFVzZXJJbmZvKCk7XG5cbmNvbnN0IGdlbmVyYXRlQ2FyZFRlbXBsYXRlID0gKCkgPT4gZG9jdW1lbnRcbiAgICAucXVlcnlTZWxlY3RvcihcIiNlbGVtZW50c1wiKVxuICAgIC5jb250ZW50XG4gICAgLnF1ZXJ5U2VsZWN0b3IoJy5lbGVtZW50X19jYXJkcycpXG4gICAgLmNsb25lTm9kZSh0cnVlKTtcblxuY29uc3QgaGFuZGxlQ2FyZENsaWNrID0gKGNhcmQpID0+IHtcbiAgICBjb25zdCBwb3B1cEltYWdlID0gbmV3IFBvcHVwV2l0aEltYWdlKHsgbmFtZTogY2FyZC5fbmFtZSwgbGluazogY2FyZC5fbGluayB9LCAnLnBvcHVwX3R5cGVfaW1nJyk7XG4gICAgcG9wdXBJbWFnZS5vcGVuKCk7XG59O1xuXG5jb25zdCBjYXJkc0xpc3QgPSBuZXcgU2VjdGlvbih7XG4gICAgaXRlbXM6IGluaXRpYWxDYXJkcyxcbiAgICByZW5kZXJlcjogKGl0ZW0pID0+IHtcbiAgICAgICAgY29uc3QgY2FyZCA9IG5ldyBDYXJkKGl0ZW0ubmFtZSwgaXRlbS5saW5rLCBnZW5lcmF0ZUNhcmRUZW1wbGF0ZSgpLCBoYW5kbGVDYXJkQ2xpY2spO1xuXG4gICAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZC5nZW5lcmF0ZUNhcmQoKTtcblxuICAgICAgICBjYXJkc0xpc3QuYWRkSXRlbShjYXJkRWxlbWVudCk7XG5cbiAgICAgICAgaGFuZGxlQ2FyZENsaWNrLmJpbmQoaXRlbSk7XG5cbiAgICB9XG59LFxuICAgICcuZWxlbWVudCdcbik7XG5cbmNhcmRzTGlzdC5yZW5kZXJJdGVtcygpO1xuXG5jb25zdCBmb3JtQWRkID0gbmV3IFBvcHVwV2l0aEZvcm0oe1xuICAgIHBvcHVwU2VsZWN0b3I6ICcucG9wdXBfdHlwZV9hZGQnLFxuICAgIHBvcHVwRmllbGQ6ICcucG9wdXBfX2ZpZWxkJyxcbiAgICBoYW5kbGVGb3JtU3VibWl0OiAoaW5wdXRWYWx1ZXMpID0+IHtcbiAgICAgICAgY2FyZHNMaXN0Ll9yZW5kZXJlcih7IG5hbWU6IGlucHV0VmFsdWVzLnRpdGxlLCBsaW5rOiBpbnB1dFZhbHVlcy5waWN0dXJlIH0pXG4gICAgICAgIGZvcm1BZGQuY2xvc2UoKTtcbiAgICB9XG59KTtcblxuYWRkQ2FyZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBmb3JtQWRkLm9wZW4oKTtcblxuICAgIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20ocG9wdXBBZGQucXVlcnlTZWxlY3RvckFsbCgnLnBvcHVwX19maWVsZCcpKTtcbiAgICBjb25zdCBidXR0b25FbGVtZW50ID0gcG9wdXBBZGQucXVlcnlTZWxlY3RvcignLnBvcHVwX19zdWJtaXQtYnV0dG9uJyk7XG5cbiAgICBmb3JtQWRkVmFsaWRhdG9yLnRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCk7XG59KTtcblxuY29uc3QgZm9ybUVkaXQgPSBuZXcgUG9wdXBXaXRoRm9ybSh7XG4gICAgcG9wdXBTZWxlY3RvcjogJy5wb3B1cF90eXBlX2VkaXQnLFxuICAgIHBvcHVwRmllbGQ6ICcucG9wdXBfX2ZpZWxkJyxcbiAgICBoYW5kbGVGb3JtU3VibWl0OiAoaW5wdXRzVmFsdWVzKSA9PiB7XG4gICAgICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHsgbmFtZTogaW5wdXRzVmFsdWVzLmZ1bGxuYW1lLCBqb2I6IGlucHV0c1ZhbHVlcy5qb2IgfSk7XG4gICAgICAgIGZvcm1FZGl0LmNsb3NlKCk7XG4gICAgfVxuXG59KTtcblxucHJvZmlsZUVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgY29uc3QgcHJvZmlsZSA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKCk7XG5cbiAgICBmb3JtRWRpdC5fcG9wdXBGaWVsZFswXS52YWx1ZSA9IHByb2ZpbGUubmFtZTtcbiAgICBmb3JtRWRpdC5fcG9wdXBGaWVsZFsxXS52YWx1ZSA9IHByb2ZpbGUuam9iSW5wdXQ7XG5cbiAgICBmb3JtRWRpdC5vcGVuKCk7XG59KTtcblxuY29uc3QgZm9ybUFkZFZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKHBhcmFtcywgcGFyYW1zLmZvcm1BZGQpO1xuZm9ybUFkZFZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XG5cbmNvbnN0IGZvcm1FZGl0VmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IocGFyYW1zLCBwYXJhbXMuZm9ybUVkaXQpO1xuZm9ybUVkaXRWYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuXG5cbiJdLCJzb3VyY2VSb290IjoiIn0=